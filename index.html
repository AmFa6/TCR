<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TCR Map</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
        crossorigin=""/>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="map"></div>
    
    <div id="legend">
        <div class="legend-header">
            <h4 class="legend-title">Map Layers</h4>
            <span id="toggle-legend"></span>
        </div>
        <div id="legend-content-wrapper">
            
            <!-- Individual layers without categories -->
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                <div style="display: flex; align-items: center;">
                    <input type="checkbox" id="growth-zones" checked style="margin-right: 8px;">
                    <div style="width: 16px; height: 16px; background-color: transparent; border: 2px solid #000; margin-right: 8px;"></div>
                    <span>Growth Zones</span>
                </div>
                <div class="layer-controls">
                    <span class="layer-icon palette-icon" data-layer="growth-zones" title="Style">ðŸŽ¨</span>
                    <span class="layer-icon filter-icon" data-layer="growth-zones" title="Filter">ðŸ”½</span>
                </div>
            </div>
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                <div style="display: flex; align-items: center;">
                    <input type="checkbox" id="housing" checked style="margin-right: 8px;">
                    <div style="width: 16px; height: 16px; background-color: transparent; border: 1px solid #000; margin-right: 8px;"></div>
                    <span>Housing</span>
                </div>
                <div class="layer-controls">
                    <span class="layer-icon palette-icon" data-layer="housing" title="Style">ðŸŽ¨</span>
                    <span class="layer-icon filter-icon" data-layer="housing" title="Filter">ðŸ”½</span>
                </div>
            </div>
            <!-- PTAL with graduated color scale -->
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                <div style="display: flex; align-items: center;">
                    <input type="checkbox" id="ptal" checked style="margin-right: 8px;">
                    <div class="ptal-legend-container" style="margin-right: 8px;">
                        <div class="graduated-legend" id="ptal-color-scale" style="cursor: pointer;" title="Click to customize styling">
                            <div class="color-bar">
                                <div class="color-segment" style="background-color: #08306b;"></div>
                                <div class="color-segment" style="background-color: #2171b5;"></div>
                                <div class="color-segment" style="background-color: #6baed6;"></div>
                                <div class="color-segment" style="background-color: #31a354;"></div>
                                <div class="color-segment" style="background-color: #fed976;"></div>
                                <div class="color-segment" style="background-color: #fd8d3c;"></div>
                                <div class="color-segment" style="background-color: #e31a1c;"></div>
                                <div class="color-segment" style="background-color: #99000d;"></div>
                            </div>
                            <div class="legend-labels">
                                <span class="legend-label-start">0/1a</span>
                                <span class="legend-label-end">6b</span>
                            </div>
                        </div>
                    </div>
                    <span>PTAL (Transport Accessibility)</span>
                </div>
                <div class="layer-controls">
                    <span class="layer-icon palette-icon" data-layer="ptal" title="Style">ðŸŽ¨</span>
                    <span class="layer-icon filter-icon" data-layer="ptal" title="Filter">ðŸ”½</span>
                </div>
            </div>
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                <div style="display: flex; align-items: center;">
                    <input type="checkbox" id="tcr-schemes" checked style="margin-right: 8px;">
                    <div style="width: 16px; height: 16px; background-color: transparent; border: 0.5px solid #ff00ff; margin-right: 8px;"></div>
                    <span>TCR Schemes</span>
                </div>
                <div class="layer-controls">
                    <span class="layer-icon palette-icon" data-layer="tcr-schemes" title="Style">ðŸŽ¨</span>
                    <span class="layer-icon filter-icon" data-layer="tcr-schemes" title="Filter">ðŸ”½</span>
                </div>
            </div>
            
            <!-- Transport Infrastructure as the only grouped category -->
            <div class="legend-category">
                <div class="legend-category-header">
                    <span>Transport Infrastructure</span>
                </div>
                <div class="legend-category-content">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                        <div style="display: flex; align-items: center;">
                            <input type="checkbox" id="bus-lines" checked style="margin-right: 8px;">
                            <div style="width: 20px; height: 3px; border-top: 2px solid #008000; margin-right: 8px;"></div>
                            <span>Bus Lines</span>
                        </div>
                        <div class="layer-controls">
                            <span class="layer-icon palette-icon" data-layer="bus-lines" title="Style">ðŸŽ¨</span>
                            <span class="layer-icon filter-icon" data-layer="bus-lines" title="Filter">ðŸ”½</span>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                        <div style="display: flex; align-items: center;">
                            <input type="checkbox" id="bus-stops" checked style="margin-right: 8px;">
                            <div style="width: 8px; height: 8px; background-color: #008000; border-radius: 50%; margin-right: 8px; border: 1px solid #008000;"></div>
                            <span>Bus Stops</span>
                        </div>
                        <div class="layer-controls">
                            <span class="layer-icon palette-icon" data-layer="bus-stops" title="Style">ðŸŽ¨</span>
                            <span class="layer-icon filter-icon" data-layer="bus-stops" title="Filter">ðŸ”½</span>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                        <div style="display: flex; align-items: center;">
                            <input type="checkbox" id="rail-stations" checked style="margin-right: 8px;">
                            <div style="width: 10px; height: 10px; background-color: #8B4513; border-radius: 50%; margin-right: 8px; border: 2px solid #8B4513;"></div>
                            <span>Rail Stations</span>
                        </div>
                        <div class="layer-controls">
                            <span class="layer-icon palette-icon" data-layer="rail-stations" title="Style">ðŸŽ¨</span>
                            <span class="layer-icon filter-icon" data-layer="rail-stations" title="Filter">ðŸ”½</span>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
    </div>
    
    <!-- Styling Control Modal -->
    <div id="styling-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Layer Styling</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="styling-section">
                    <h4>Display Options</h4>
                    <div class="control-group">
                        <label for="opacity-slider">Opacity:</label>
                        <input type="range" id="opacity-slider" min="0" max="1" step="0.1" value="0.7">
                        <span id="opacity-value">70%</span>
                    </div>
                    <div class="control-group">
                        <label for="size-slider">Size/Weight:</label>
                        <input type="range" id="size-slider" min="0.5" max="5" step="0.5" value="2">
                        <span id="size-value">2</span>
                    </div>
                </div>
                
                <div class="styling-section">
                    <h4>Color Scheme</h4>
                    <div class="control-group">
                        <label for="color-scheme">Predefined Schemes:</label>
                        <select id="color-scheme">
                            <option value="blue-red">Blue to Red (Default)</option>
                            <option value="viridis">Viridis</option>
                            <option value="plasma">Plasma</option>
                            <option value="cool-warm">Cool to Warm</option>
                            <option value="greens">Greens</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label for="custom-color">Custom Single Color:</label>
                        <input type="color" id="custom-color" value="#3388ff">
                        <button id="apply-custom-color">Apply Single Color</button>
                    </div>
                </div>
                
                <div class="styling-section">
                    <h4>Classification</h4>
                    <div class="control-group">
                        <label for="classification-method">Method:</label>
                        <select id="classification-method">
                            <option value="categories">Categories (Current)</option>
                            <option value="graduated">Graduated by Attribute</option>
                        </select>
                    </div>
                    <div id="graduated-options" style="display: none;">
                        <div class="control-group">
                            <label for="classification-attribute">Attribute:</label>
                            <select id="classification-attribute">
                                <option value="PTAL">PTAL Level</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label for="class-count">Number of Classes:</label>
                            <input type="number" id="class-count" min="3" max="10" value="8">
                        </div>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button id="apply-styling">Apply Changes</button>
                    <button id="reset-styling">Reset to Default</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Filter Control Modal -->
    <div id="filter-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="filter-modal-title">Layer Filter</h3>
                <span class="close filter-close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="styling-section">
                    <h4>Attribute Filters</h4>
                    <div class="control-group">
                        <label for="filter-attribute">Filter by Attribute:</label>
                        <select id="filter-attribute">
                            <option value="">Select attribute...</option>
                        </select>
                    </div>
                    <div id="filter-controls" style="display: none;">
                        <div class="control-group">
                            <label for="filter-operator">Operator:</label>
                            <select id="filter-operator">
                                <option value="equals">Equals</option>
                                <option value="contains">Contains</option>
                                <option value="greater">Greater than</option>
                                <option value="less">Less than</option>
                                <option value="between">Between</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label for="filter-value">Value:</label>
                            <input type="text" id="filter-value" placeholder="Enter filter value">
                        </div>
                        <div class="control-group" id="filter-value2-group" style="display: none;">
                            <label for="filter-value2">To:</label>
                            <input type="text" id="filter-value2" placeholder="Enter second value">
                        </div>
                    </div>
                </div>
                
                <div class="styling-section">
                    <h4>Spatial Filters</h4>
                    <div class="control-group">
                        <button id="filter-visible-extent">Filter to Visible Extent</button>
                        <button id="clear-spatial-filter">Clear Spatial Filter</button>
                    </div>
                </div>
                
                <div class="styling-section">
                    <h4>Active Filters</h4>
                    <div id="active-filters-list">
                        <p class="no-filters">No active filters</p>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button id="apply-filter">Apply Filter</button>
                    <button id="clear-all-filters">Clear All Filters</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin=""></script>
    
    <!-- Proj4 for coordinate transformations -->
    <script src="https://unpkg.com/proj4@2.9.0/dist/proj4.js"></script>
    <script src="https://unpkg.com/proj4leaflet@1.0.2/dist/proj4leaflet.min.js"></script>
    
    <!-- Custom JavaScript -->
    <script src="map.js"></script>
</body>
</html>